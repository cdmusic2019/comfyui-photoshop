本版本是在原版v1.93基础上进行修复，优化和升级而来，进行了多项修复和改进，也添加了一些新功能：

 一，功能重写：

   1. 蒙版
       对蒙版（mask)的获取代码进行了重写，让它可以支持ps最新版本。支持ps2024-ps2026,输出标准的黑白蒙版

    2. rgthree节点支持最新版本：
       对工作流分组节点同步代码进行了重写，可以支持最新版本的rgthree,代码上增加更多的颜色匹配方式，更容易同步工作流（如果你还在使用老板本工作的话）。

    3. 图片传输优化
      对图片（蒙版除外）的传输方式进行了重写，包括从ps获取图片，或comfyui生成的图片发送到PS,弃用了原来的编码方式（base64编码），采用二进制的方式来传送，获取最快的传输速率。

    4. 图片清晰度优化。
       首先是从PS获取图片，原版本获取的是PSR 预览，收于图片较小（1024x1021）只有50-80kb,图片质量较低，放大会模糊，有伪影。现已对获取函数进行了重写，直接获取PS元图片，清晰度和PS一致，文档较大，一般1K的图片 在3M-4M，2K的图片大小10-20M左右，4K的图片 30-40M左右。目前能支持5400x5400分辫率的高清获取，超出会压缩。
      另外，从comfyui传送图片到ps不再压缩，保持comfyui生成图片时的清晰度和文件大小。

    5. PS端图片容器重写（最大支持9张图片）
       原版本只支持1张图片（1x1）显示。现在对容器进行了重写，增加了2x2 和3x3的图片网格，支持从comfyui发送到PS的图片数量是1-9张，根据图片数量使用不同的网格。（PS端接收图片的逻辑是图片组（image batch）,无论用何种方式生成的batch都可以输送到ps中）
 
二，界面或UI修复。
   1.  PS插件端左上角的三个图标缩小到原来的2/3,右边的滑块改为细条型，这样可以显示更多的图片元素。

   2 .种子框，提示词框，双箭头功能进行了优化，可以同步显示种子，提示词，另外也包括设置面板中的种子和提示词

   3. 前面版中的提示词输入框可以输入中文了，增加了延时和鼠标检测事件，可以直接进行中文录入。但是需要注意，输入中文时，将鼠标移到插件内部的任意地方不要让鼠标落在输入法的选词框上即可，不然也会意外关闭提示词输入框造成无法输入。

   4. 设置面板中的缩放参数“DownScale if Bigger” 和“Upscale if Smaller.”进行了优化，修改后不需要重起插件，只需要PS画布中有任何改变（包括选区）就会立即生效。

   5.进度条进行了改进，只要有rander动作，就会预先加载进度条，让你第一时间知道comfyui已经运行。

   6. 修复了一个可能出现的bug，当PS端短时间内高频率做无效连接时，服务端会产生永久性断连，造成永久性的失连，以前的方法是，把comfyui中自定义节点下的comfyui-photoshop文件夹删除，重新复制一个新的考贝即可恢复，现已修复，应该不再出现。

   7.社区中见到的大部份bug都已经修复。

总之，这个版本应该是目前最完整的版本，优化了很多地方，可能透过界面你看不出来，但你明显能感觉得传输速度的提升和更加稳定，以及图片质量的提高。








Release Notes - Version Update

This version is built upon the original v1.93 with fixes, optimizations, and upgrades, incorporating multiple repairs and improvements along with new features:

1. Function Rewrites:

   1.1 Mask
      The code for obtaining masks has been rewritten to support the latest versions of Photoshop. It now supports PS2024–PS2026 and outputs standard black-and-white masks.

   1.2 rgthree Node Support for the Latest Version
      The workflow grouping node synchronization code has been rewritten to support the latest version of rgthree. More color-matching methods have been added to the code, making workflow synchronization easier (especially if you are still using older workflow versions).

   1.3 Image Transfer Optimization
      The image transfer method (excluding masks) has been rewritten, including fetching images from Photoshop or sending images generated by ComfyUI to Photoshop. The previous encoding method (base64 encoding) has been deprecated in favor of a binary approach to achieve the fastest transfer rates.

   1.4 Image Clarity Optimization
      First, the method of fetching images from Photoshop has been rewritten. The original version retrieved PSR previews, which were smaller (1024x1024) at only 50–80 KB, resulting in lower image quality, blurriness when enlarged, and artifacts. The new function directly retrieves the original Photoshop images, maintaining the same clarity as in Photoshop. File sizes are larger, typically 3–4 MB for 1K images, 10–20 MB for 2K images, and 30–40 MB for 4K images. The system now supports high-definition retrieval up to 5400x5400 resolution; anything beyond this will be compressed.
      Additionally, images transferred from ComfyUI to Photoshop are no longer compressed, preserving the clarity and file size of the images generated by ComfyUI.

   1.5 Photoshop Image Container Rewrite (Supports Up to 9 Images)
      The original version only supported displaying one image (1x1). The container has been rewritten to include 2x2 and 3x3 image grids, supporting 1–9 images sent from ComfyUI to Photoshop. Different grids are used depending on the number of images. (The logic for receiving images on the Photoshop side is image batches, meaning batches generated in any way can be sent to Photoshop.)

2. Interface or UI Fixes:

   2.1 The three icons in the upper-left corner of the Photoshop plugin have been reduced to two-thirds of their original size, and the slider on the right has been changed to a thin bar to display more image elements.

   2.2 The seed box, prompt box, and double-arrow functionality have been optimized to synchronize and display seeds and prompts, including those in the settings panel.

   2.3 The prompt input box in the front panel now supports Chinese input. Delayed and mouse detection events have been added to allow direct Chinese input. Note: When inputting Chinese, ensure the mouse is placed anywhere inside the plugin and not on the input method candidate box, as this could unexpectedly close the prompt input box and prevent input.

   2.4 The scaling parameters "DownScale if Bigger" and "Upscale if Smaller" in the settings panel have been optimized. Changes now take effect immediately without restarting the plugin, as long as there is any change (including selections) in the Photoshop canvas.

   2.5 The progress bar has been improved to preload whenever a render action occurs, allowing users to immediately know when ComfyUI is running.

   2.6 Fixed a potential bug where frequent invalid connections from Photoshop in a short period could cause a permanent disconnection on the server, leading to persistent loss of connectivity. Previously, the solution was to delete the `comfyui-photoshop` folder under the custom node in ComfyUI and replace it with a new copy. This issue has been resolved and should no longer occur.

   2.7 Most bugs reported in the community have been fixed.

In summary, this version is currently the most comprehensive one, with many optimizations that may not be visible through the interface. However, users will clearly notice improvements in transfer speed, stability, and image quality.
   

